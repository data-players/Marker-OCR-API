version: '3.8'

services:
  # Test services (modelFree - without heavy ML dependencies)
  backend-test-modelfree:
    build:
      context: ./backend
      dockerfile: Dockerfile.test-modelFree
    volumes:
      - ./backend:/app:ro  # Read-only backend code
      - ./tests:/tests:ro  # Mount tests directory
      - ./shared/uploads:/app/uploads
      - ./shared/outputs:/app/outputs
    working_dir: /tests
    environment:
      - PYTHONPATH=/app
      - ENVIRONMENT=test
      - LOG_LEVEL=DEBUG
      - UPLOAD_DIR=/app/uploads
      - OUTPUT_DIR=/app/outputs
      - API_BASE_URL=${API_BASE_URL:-http://host.docker.internal:8000}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - marker-network

  frontend-test:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: test
    volumes:
      - ./frontend/src:/app/src:ro
      - ./tests/frontend:/app/tests:ro
    environment:
      - NODE_ENV=test
    networks:
      - marker-network
    command: npm test -- --coverage --watchAll=false

networks:
  marker-network:
    driver: bridge

volumes:
  redis_data:
  backend_uploads:
  backend_outputs:







