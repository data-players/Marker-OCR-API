version: '3.8'

services:
  # Test services
  backend-test:
    build:
      context: ./backend
      dockerfile: Dockerfile.test
    volumes:
      - ./shared/uploads:/app/uploads
      - ./shared/outputs:/app/outputs
    environment:
      - PYTHONPATH=/app
      - ENVIRONMENT=test
      - LOG_LEVEL=DEBUG
      - UPLOAD_DIR=/app/uploads
      - OUTPUT_DIR=/app/outputs
    networks:
      - marker-network

  frontend-test:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: test
    volumes:
      - ./frontend/src:/app/src:ro
    environment:
      - NODE_ENV=test
    networks:
      - marker-network
    command: npm test -- --coverage --watchAll=false

networks:
  marker-network:
    driver: bridge

volumes:
  redis_data:
  backend_uploads:
  backend_outputs:






